<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Admin - Manage All Events</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        body { margin: 20px; }
        .admin-header { background-color: #dc3545; color: white; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        table { width: 100%; border-collapse: collapse; margin-top: 20px; }
        th, td { border: 1px solid #ddd; padding: 12px; text-align: left; }
        th { background-color: #f8f9fa; font-weight: bold; }
        tr:nth-child(even) { background-color: #f8f9fa; }
        .btn { padding: 8px 16px; margin: 2px; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; }
        .btn-danger { background-color: #dc3545; color: white; }
        .btn-info { background-color: #17a2b8; color: white; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn:hover { opacity: 0.8; }
        .event-actions { white-space: nowrap; }
        .status { padding: 4px 8px; border-radius: 12px; font-size: 0.8em; font-weight: bold; }
        .status-upcoming { background-color: #d4edda; color: #155724; }
        .status-past { background-color: #f8d7da; color: #721c24; }
        
        /* Modern Statistics Cards */
        .stats-container {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(280px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 16px;
            display: flex;
            align-items: center;
            gap: 20px;
            box-shadow: 0 4px 6px rgba(0, 0, 0, 0.07);
            transition: all 0.3s ease;
            position: relative;
            overflow: hidden;
        }
        
        .stat-card::before {
            content: '';
            position: absolute;
            top: 0;
            left: 0;
            width: 100%;
            height: 4px;
            transition: height 0.3s ease;
        }
        
        .stat-card:hover {
            transform: translateY(-5px);
            box-shadow: 0 12px 24px rgba(0, 0, 0, 0.15);
        }
        
        .stat-card:hover::before {
            height: 100%;
            opacity: 0.05;
        }
        
        .stat-card-total::before {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        
        .stat-card-upcoming::before {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
        }
        
        .stat-card-past::before {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
        }
        
        .stat-icon {
            width: 70px;
            height: 70px;
            border-radius: 14px;
            display: flex;
            align-items: center;
            justify-content: center;
            flex-shrink: 0;
            transition: transform 0.3s ease;
        }
        
        .stat-card:hover .stat-icon {
            transform: scale(1.1) rotate(5deg);
        }
        
        .stat-card-total .stat-icon {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
        }
        
        .stat-card-upcoming .stat-icon {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            color: white;
        }
        
        .stat-card-past .stat-icon {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            color: white;
        }
        
        .stat-content {
            flex: 1;
        }
        
        .stat-number {
            font-size: 2.5em;
            font-weight: 700;
            margin: 0;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
            line-height: 1.2;
        }
        
        .stat-card-upcoming .stat-number {
            background: linear-gradient(135deg, #f093fb 0%, #f5576c 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-card-past .stat-number {
            background: linear-gradient(135deg, #4facfe 0%, #00f2fe 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }
        
        .stat-label {
            font-size: 0.95em;
            color: #6c757d;
            margin: 5px 0 0 0;
            font-weight: 600;
            text-transform: uppercase;
            letter-spacing: 0.5px;
        }

        .btn-download {
            background-color: #28a745; /* Green */
            color: white;
        }
        .btn-download:hover {
            opacity: 0.9;
        }
        
        @media (max-width: 768px) {
            .stats-container {
                grid-template-columns: 1fr;
            }
        }
    </style>
</head>
<body>
<div th:replace="~{fragments/navbar-common :: navbar-common(${currentUser})}"></div>

<div class="admin-header">
    <h1>üõ°Ô∏è Admin Panel - Event Management</h1>
    <p>View and manage all events across the platform</p>
</div>

<div th:replace="~{fragments/alert-banner :: alert-banner(${success}, ${error}, ${info})}"></div>

<!-- Navigation Links -->
<div style="margin-bottom: 20px;">
    <a href="/admin/dashboard" class="btn btn-primary">üìä Dashboard</a>
    <a href="/users" class="btn btn-info">üë• Manage Users</a>
    <a href="/" class="btn btn-info">üåç Public Events View</a>
</div>

<!-- Events Statistics -->
<div class="stats-container">
    <div class="stat-card stat-card-total">
        <div class="stat-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" viewBox="0 0 16 16">
                <path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM1 4v10a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V4H1z"/>
            </svg>
        </div>
        <div class="stat-content">
            <h3 class="stat-number" th:text="${events != null ? #lists.size(events) : 0}">0</h3>
            <p class="stat-label">Total Events</p>
        </div>
    </div>
    
    <div class="stat-card stat-card-upcoming">
        <div class="stat-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" viewBox="0 0 16 16">
                <path d="M16 8A8 8 0 1 1 0 8a8 8 0 0 1 16 0zM8 3.5a.5.5 0 0 0-1 0V9a.5.5 0 0 0 .252.434l3.5 2a.5.5 0 0 0 .496-.868L8 8.71V3.5z"/>
            </svg>
        </div>
        <div class="stat-content">
            <h3 class="stat-number" th:text="${upcomingEventsCount}">0</h3>
            <p class="stat-label">Upcoming Events</p>
        </div>
    </div>
    
    <div class="stat-card stat-card-past">
        <div class="stat-icon">
            <svg xmlns="http://www.w3.org/2000/svg" width="40" height="40" fill="currentColor" viewBox="0 0 16 16">
                <path d="M10.854 8.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 0 1 .708-.708L7.5 10.793l2.646-2.647a.5.5 0 0 1 .708 0z"/>
                <path d="M8 1a2.5 2.5 0 0 1 2.5 2.5V4h-5v-.5A2.5 2.5 0 0 1 8 1zm3.5 3v-.5a3.5 3.5 0 1 0-7 0V4H1v10a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V4h-3.5z"/>
            </svg>
        </div>
        <div class="stat-content">
            <h3 class="stat-number" th:text="${pastEventsCount}">0</h3>
            <p class="stat-label">Past Events</p>
        </div>
    </div>
</div>

<!-- Events Table -->
<h2>All Events</h2>

<!-- Button to download CSV of registrations -->
<a th:href="@{'/admin/events/all/attendees.csv'}"
   class="btn btn-download"
   style="font-size: 0.8em;"
   download>
    üì• Download CSV of All Registrations
</a>

<div th:if="${events == null || #lists.isEmpty(events)}" style="text-align: center; padding: 40px; color: #6c757d;">
    <h3>üìÖ No Events Found</h3>
    <p>There are currently no events in the system.</p>
</div>

<table th:unless="${events == null || #lists.isEmpty(events)}">
    <thead>
    <tr>
        <th>ID</th>
        <th>Title</th>
        <th>Organizer</th>
        <th>Date & Time</th>
        <th>Location</th>
        <th>Status</th>
        <th>Registrations</th>
        <th>Actions</th>
    </tr>
    </thead>
    <tbody>
    <tr th:each="event : ${events}">
        <td th:text="${event.eventId}">1</td>
        <td>
            <strong th:text="${event.title}">Event Title</strong>
            <br>
            <small th:text="${event.description}" style="color: #6c757d;">Event Description</small>
        </td>
        <td>
            <span th:text="${event.organiser != null ? event.organiser.name : 'Unknown'}">Organizer Name</span>
            <br>
            <small th:text="${event.organiser != null ? event.organiser.email : ''}" style="color: #6c757d;">organizer@email.com</small>
        </td>
        <td th:text="${#temporals.format(event.dateTime, 'yyyy-MM-dd HH:mm')}">2024-01-01 10:00</td>
        <td th:text="${event.location}">Location</td>
        <td>
            <span th:if="${event.dateTime.isAfter(#temporals.createNow())}"
                  class="status status-upcoming">Upcoming</span>
            <span th:if="${event.dateTime.isBefore(#temporals.createNow())}"
                  class="status status-past">Past</span>
        </td>
        <td>
            <span th:text="${event.registrations != null ? #lists.size(event.registrations) : 0}">0</span>
        </td>
        <td class="event-actions">
            <!-- View Event Details -->
            <a th:href="@{'/events/detail/' + ${event.eventId}}"
               class="btn btn-info"
               style="font-size: 0.8em;">üëÅÔ∏è View</a>

            <!-- Edit Event (redirect to admin edit) -->
            <a th:href="@{'/admin/events/' + ${event.eventId} + '/edit'}"
               class="btn btn-primary">‚úèÔ∏è Edit Event</a>

            <!-- Download Attendees CSV -->
            <a th:href="@{'/admin/events/' + ${event.eventId} + '/attendees.csv'}"
               class="btn btn-download"
               style="font-size: 0.8em;"
               download>
                üì• Download CSV
            </a>

            <!-- Delete Event -->
            <form th:action="@{'/events/' + ${event.eventId} + '/delete'}"
                  method="post"
                  style="display: inline;"
                  onsubmit="return confirm('Are you sure you want to delete this event? This action cannot be undone.');">
                <button type="submit" class="btn btn-danger" style="font-size: 0.8em;">üóëÔ∏è Delete</button>
            </form>
        </td>
    </tr>
    </tbody>
</table>

<!-- Footer -->
<div style="margin-top: 40px; padding: 20px; background-color: #f8f9fa; border-radius: 5px; text-align: center; color: #6c757d;">
    <p><strong>Admin Panel</strong> | EventHub Campus Event Management System</p>
    <p>Use admin privileges responsibly. All actions are logged.</p>
</div>
</body>
</html>