<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org" lang="en">
<head>
    <title>Admin - Edit User Role</title>
    <link rel="stylesheet" th:href="@{/css/style.css}">
    <style>
        body { margin: 20px; background-color: #f5f5f5; }
        .admin-header { background-color: #dc3545; color: white; padding: 15px; margin-bottom: 20px; border-radius: 5px; }
        .form-container { max-width: 600px; margin: 0 auto; background-color: white; padding: 30px; border-radius: 8px; box-shadow: 0 2px 4px rgba(0,0,0,0.1); }
        .form-group { margin-bottom: 20px; }
        .form-group label { display: block; font-weight: bold; margin-bottom: 8px; color: #333; }
        .form-group input, .form-group select { width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 4px; font-size: 1em; }
        .form-group input:disabled { background-color: #e9ecef; cursor: not-allowed; }
        .btn { padding: 10px 20px; margin: 5px; border: none; border-radius: 4px; cursor: pointer; text-decoration: none; display: inline-block; font-size: 1em; }
        .btn-primary { background-color: #007bff; color: white; }
        .btn-secondary { background-color: #6c757d; color: white; }
        .btn:hover { opacity: 0.8; }
        .alert { padding: 15px; margin-bottom: 20px; border-radius: 4px; }
        .alert-info { background-color: #d1ecf1; color: #0c5460; border: 1px solid #bee5eb; }
        .alert-warning { background-color: #fff3cd; color: #856404; border: 1px solid #ffc107; }
        .user-info-card { background-color: #f8f9fa; padding: 20px; border-radius: 5px; margin-bottom: 20px; }
        .user-info-item { margin-bottom: 10px; }
        .user-info-item strong { color: #495057; }
        .role-badge { padding: 5px 10px; border-radius: 12px; font-size: 0.9em; font-weight: bold; display: inline-block; margin-left: 10px; }
        .role-admin { background-color: #dc3545; color: white; }
        .role-organiser { background-color: #28a745; color: white; }
        .role-student { background-color: #007bff; color: white; }
        .button-group { margin-top: 30px; display: flex; gap: 10px; }
    </style>
</head>
<body>
<div th:replace="~{fragments/navbar-common :: navbar-common(${currentUser})}"></div>

<div class="admin-header">
    <h1>‚úèÔ∏è Edit User Role</h1>
    <p>Update user role and permissions</p>
</div>

<div class="form-container">
    <!-- User Information Card -->
    <div class="user-info-card">
        <h3>User Information</h3>
        <div class="user-info-item">
            <strong>ID:</strong> <span th:text="${user.userId}">1</span>
        </div>
        <div class="user-info-item">
            <strong>Name:</strong> <span th:text="${user.name}">User Name</span>
        </div>
        <div class="user-info-item">
            <strong>Email:</strong> <span th:text="${user.email}">user@example.com</span>
        </div>
        <div class="user-info-item">
            <strong>Current Role:</strong> 
            <span th:text="${user.role.toString()}">STUDENT</span>
            <span th:if="${user.role.toString() == 'ADMIN'}" class="role-badge role-admin">ADMIN</span>
            <span th:if="${user.role.toString() == 'ORGANISER'}" class="role-badge role-organiser">ORGANIZER</span>
            <span th:if="${user.role.toString() == 'STUDENT'}" class="role-badge role-student">STUDENT</span>
        </div>
        <div class="user-info-item">
            <strong>Events Created:</strong> 
            <span th:text="${user.organisedEvents != null ? #lists.size(user.organisedEvents) : 0}">0</span>
        </div>
        <div class="user-info-item">
            <strong>Events Registered:</strong> 
            <span th:text="${user.registrations != null ? #lists.size(user.registrations) : 0}">0</span>
        </div>
    </div>

    <!-- Warning Messages -->
    <div class="alert alert-warning">
        <strong>‚ö†Ô∏è Important:</strong>
        <ul style="margin: 10px 0 0 20px;">
            <li>Changing a user's role will immediately affect their permissions.</li>
            <li>Making a user an ORGANIZER allows them to create and manage events.</li>
            <li>Making a user an ADMIN grants full system access.</li>
            <li>Downgrading from ORGANIZER may affect their existing events.</li>
            <li>You cannot change your own role.</li>
        </ul>
    </div>

    <!-- Role Edit Form -->
    <form th:action="@{'/users/' + ${user.userId} + '/edit'}" method="post">
        <input type="hidden" th:name="${_csrf.parameterName}" th:value="${_csrf.token}" />
        
        <div class="form-group">
            <label for="role">Select New Role:</label>
            <select id="role" name="role" required>
                <option value="" disabled>-- Select a Role --</option>
                <option th:each="userType : ${userTypes}" 
                        th:value="${userType.name()}" 
                        th:text="${userType.name()}"
                        th:selected="${userType == user.role}">
                    STUDENT
                </option>
            </select>
        </div>

        <div class="alert alert-info">
            <strong>‚ÑπÔ∏è Role Descriptions:</strong>
            <ul style="margin: 10px 0 0 20px;">
                <li><strong>STUDENT:</strong> Can browse events, register for events, and provide feedback.</li>
                <li><strong>ORGANISER:</strong> All student permissions + can create and manage events.</li>
                <li><strong>ADMIN:</strong> Full system access including user management and all events.</li>
            </ul>
        </div>

        <div class="button-group">
            <button type="submit" class="btn btn-primary">üíæ Update Role</button>
            <a th:href="@{/users}" class="btn btn-secondary">‚ùå Cancel</a>
        </div>
    </form>
</div>

<!-- Footer -->
<div style="margin-top: 40px; padding: 20px; background-color: #f8f9fa; border-radius: 5px; text-align: center; color: #6c757d;">
    <p><strong>User Role Management</strong> | EventHub Campus Event Management System</p>
    <p>Handle role assignments responsibly. All changes are logged for security.</p>
</div>
</body>
</html>

