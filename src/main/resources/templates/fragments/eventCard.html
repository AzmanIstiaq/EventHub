<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org">
<body>
<div th:fragment="eventCard(event, currentUser)">
    <div th:if="${event != null}" class="event-card">
        <div class="event-header">
            <h2 th:text="${event.title}"></h2>
        </div>

        <p class="event-meta">
            <span th:text="${#temporals.format(event.dateTime, 'yyyy-MM-dd HH:mm')}"></span> @
            <span th:text="${event.location}"></span>
        </p>

        <p th:text="${event.description}"></p>

        <!-- Action buttons -->
        <div th:if="${currentUser != null}">
            <form th:if="${event.checkUserRegistered(currentUser)}"
                  th:action="@{'/events/student/cancel/' + ${event.id}}"
                  method="post" style="display:inline;">
                <input type="hidden" name="userId" th:value="${currentUser.getId()}"/>
                <button type="submit" class="btn btn-cancel">Cancel Registration</button>
            </form>

            <form th:if="${!event.checkUserRegistered(currentUser)}"
                  th:action="@{'/events/student/register/' + ${event.id}}"
                  method="post" style="display:inline;">
                <input type="hidden" name="userId" th:value="${currentUser.getId()}"/>
                <button type="submit" class="btn btn-register">Register</button>
            </form>

            <a th:href="@{'/events/student/detail/' + ${event.id}}" class="btn btn-grey">Event Detail</a>
        </div>

        <div th:if="${currentUser == null}">
            <a th:href="@{'/events/student/public/detail/' + ${event.id}}" class="btn btn-grey">Event Detail</a>
        </div>

        <!-- Share section -->
        <div class="share-section" style="margin-top: 0.5rem;">
            <strong>Share:</strong>
            <div th:with="eventUrl=@{/events/student/public/detail/{id}(id=${event.id})}">

                <a th:href="'https://www.facebook.com/sharer/sharer.php?u=' + ${eventUrl}"
                   target="_blank" rel="noopener noreferrer" class="btn btn-grey">Facebook</a>

                <a th:href="'https://twitter.com/intent/tweet?url=' + ${eventUrl} + '&text=' + ${event.title}"
                   target="_blank" rel="noopener noreferrer" class="btn btn-grey">Twitter</a>

                <a th:href="'https://www.linkedin.com/sharing/share-offsite/?url=' + ${eventUrl}"
                   target="_blank" rel="noopener noreferrer" class="btn btn-grey">LinkedIn</a>

                <a th:href="'mailto:?subject=' + ${event.title} + '&body=Check%20out%20this%20event:%20' + ${eventUrl}"
                   class="btn btn-grey">Email</a>

                <button type="button" class="btn btn-grey"
                        th:attr="data-url=${eventUrl}" onclick="copyLink(this)">Copy Link</button>

                <button type="button" class="btn btn-grey"
                        th:attr="data-url=${eventUrl}, data-title=${event.title}"
                        onclick="shareEvent(this)">Share</button>
            </div>
        </div>
    </div>
</div>
</body>
</html>
